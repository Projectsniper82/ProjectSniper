<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solana Trading Bot</title>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    rel="stylesheet"
  />
  <style>
    :root {
      --primary-color: #9945ff;
      --secondary-color: #14f195;
      --dark-bg: #121212;
      --card-bg: #1e1e1e;
      --border-color: #333;
      --text-color: #e0e0e0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      background-color: var(--dark-bg);
      color: var(--text-color);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 320px;
      border-right: 1px solid var(--border-color);
      padding: 20px;
    }

    .main-content {
      flex: 1;
      padding: 20px;
    }

    .card {
      background-color: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .card-header {
      background-color: rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid var(--border-color);
      padding: 15px 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-body {
      padding: 20px;
    }

    .wallet-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .wallet-item:hover,
    .wallet-item.active {
      background-color: rgba(153, 69, 255, 0.1);
    }

    .wallet-item.active {
      border-left: 3px solid var(--primary-color);
    }

    .wallet-details {
      overflow: hidden;
    }

    .wallet-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .wallet-address {
      font-size: 12px;
      color: #888;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      max-width: 200px;
    }

    .wallet-balance {
      font-weight: 600;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: #8438e5;
    }

    .btn-secondary {
      background-color: var(--secondary-color);
      color: black;
    }

    .btn-secondary:hover {
      background-color: #10d080;
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-color);
    }

    .btn-outline:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }

    .btn-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      padding: 0;
    }

    .btn-add {
      background-color: var(--primary-color);
      color: white;
    }

    .section-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .form-control {
      width: 100%;
      padding: 8px 12px;
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-color);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .form-select {
      width: 100%;
      padding: 8px 12px;
      background-color: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-color);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
    }

    .form-check {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .form-check-input {
      margin-right: 8px;
    }

    .d-flex {
      display: flex;
    }

    .align-items-center {
      align-items: center;
    }

    .justify-content-between {
      justify-content: space-between;
    }

    .mr-2 {
      margin-right: 10px;
    }

    .ml-2 {
      margin-left: 10px;
    }

    .mt-3 {
      margin-top: 15px;
    }

    .mb-3 {
      margin-bottom: 15px;
    }

    .text-success {
      color: var(--secondary-color);
    }

    .text-danger {
      color: #ff5555;
    }

    .badge {
      display: inline-block;
      padding: 3px 6px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 4px;
    }

    .badge-success {
      background-color: rgba(20, 241, 149, 0.2);
      color: var(--secondary-color);
    }

    .badge-danger {
      background-color: rgba(255, 85, 85, 0.2);
      color: #ff5555;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #444;
      transition: 0.4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--secondary-color);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    .tab-nav {
      <div class="card">
        {% for wallet in wallets %}
        <div class="wallet-item {% if wallet.is_active %}active{% endif %}" data-wallet-id="{{ wallet.id }}" onclick="selectWallet(this)">
          <div class="wallet-details">
            <div class="wallet-name">{{ wallet.name }}</div>
            <div class="wallet-address">{{ wallet.pubkey[:8] }}...{{ wallet.pubkey[-8:] }}</div>
          </div>
          <div class="wallet-balance">{{ wallet.sol_balance }} SOL</div>
        </div>
        {% endfor %}
      </div>

    .status-inactive {
      background-color: #ff5555;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Left Sidebar - Wallet List -->
    <div class="sidebar">
      <div class="section-title">
        <h3>Your Wallets</h3>
        <button class="btn btn-icon btn-add">+</button>
      </div>
      <div class="card">
        <!-- Example wallet items; in a real app these would be dynamically generated -->
        <div class="wallet-item active">
          <div class="wallet-details">
            <div class="wallet-name">Sniper Bot</div>
            <div class="wallet-address">ZwxraEnc...TESYaN1s</div>
          </div>
          <div class="wallet-balance">0 SOL</div>
        </div>
        <div class="wallet-item">
          <div class="wallet-details">
            <div class="wallet-name">Wallet 2</div>
            <div class="wallet-address">ZDB7bGKv...qjEgD9en</div>
          </div>
          <div class="wallet-balance">0 SOL</div>
        </div>
        <div class="wallet-item">
          <div class="wallet-details">
            <div class="wallet-name">Wallet 3</div>
            <div class="wallet-address">6RjtRq...V1Z39J3</div>
          </div>
          <div class="wallet-balance">0 SOL</div>
        </div>
        <div class="wallet-item">
          <div class="wallet-details">
            <div class="wallet-name">Wallet 4</div>
            <div class="wallet-address">Jj9tWuzG...jb9yNFip</div>
          </div>
          <div class="wallet-balance">0 SOL</div>
        </div>
        <div class="wallet-item">
          <div class="wallet-details">
            <div class="wallet-name">Wallet 5</div>
            <div class="wallet-address">5kUUbkty...13y4wrTo</div>
          </div>
          <div class="wallet-balance">0 SOL</div>
        </div>
        <div class="wallet-item">
          <div class="wallet-details">
            <div class="wallet-name">Wallet 6</div>
            <div class="wallet-address">qIwPrB1...3nbAqoMo</div>
          </div>
          <div class="wallet-balance">0 SOL</div>
        </div>
        <div class="wallet-item">
          <div class="wallet-details">
            <div class="wallet-name">Test Wallet</div>
            <div class="wallet-address">AfzsTnn...4kM4ydvQ</div>
          </div>
          <div class="wallet-balance">0 SOL</div>
        </div>
      </div>
      <div class="card mt-3">
        <div class="card-header">System Health</div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-3">
            <div>Connection Status</div>
            <div class="badge badge-success">Connected</div>
          </div>
          <div class="d-flex justify-content-between">
            <div>Network</div>
            <div class="badge badge-success">Mainnet</div>
          </div>
        </div>
      </div>
    </div>
    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Wallet Details Card -->
      <div class="card">
        <div class="card-header">
          <h3>Wallet Details</h3>
        </div>
        <div class="card-body">
          <h2>Sniper Bot</h2>
          <div class="wallet-address mb-3">
            ZwxraEncQGaqUQ4XkQdWTQaXPVw2Lnack65ITESYaN1s
            <button
              class="btn btn-sm btn-outline ml-2"
              onclick="copyToClipboard('ZwxraEncQGaqUQ4XkQdWTQaXPVw2Lnack65ITESYaN1s')"
            >
              <i class="fas fa-copy"></i>
            </button>
          </div>
          <div class="mb-3">
            <h1>0 SOL</h1>
            <div>$0.00</div>
          </div>
          <div class="d-flex">
            <button class="btn btn-primary mr-2">
              <i class="fas fa-sync-alt mr-2"></i> Refresh
            </button>
            <button class="btn btn-secondary mr-2">
              <i class="fas fa-parachute-box mr-2"></i> Request Airdrop
            </button>
            <button class="btn btn-outline">
              <i class="fas fa-paper-plane mr-2"></i> Send
            </button>
          </div>
        </div>
      </div>
      <!-- Trading Bot Controls Card -->
      <div class="card">
        <div class="card-header">
          <h3>Trading Bot</h3>
          <div class="trading-bot-status">
            <div class="status-indicator status-inactive"></div>
            <span>Inactive</span>
          </div>
        </div>
        <div class="card-body">
          <div class="tab-nav">
            <div class="tab-link active" data-tab="bot-config">Bot Configuration</div>
            <div class="tab-link" data-tab="manual-trade">Manual Trading</div>
            <div class="tab-link" data-tab="trade-history">Trade History</div>
          </div>
          <!-- Bot Configuration Tab -->
          <div id="bot-config" class="tab-content active">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h4>Trading Bot Status</h4>
              <label class="toggle-switch">
                <input type="checkbox" id="botToggle" onchange="toggleBot(this.checked)" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="trading-bot-card">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5>Strategy Settings</h5>
                <button class="btn btn-sm btn-outline" onclick="saveStrategy()">Save</button>
              </div>
              <div class="form-group">
                <label class="form-label">Strategy Type</label>
                <select class="form-select" id="strategyType">
                  <option value="sniper">Token Sniper</option>
                  <option value="dca">Dollar Cost Averaging</option>
                  <option value="swing">Swing Trading</option>
                  <option value="grid">Grid Trading</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Risk Level</label>
                <select class="form-select" id="riskLevel">
                  <option value="low">Low Risk</option>
                  <option value="medium" selected>Medium Risk</option>
                  <option value="high">High Risk</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Maximum Transaction (SOL)</label>
                <input
                  type="number"
                  class="form-control"
                  id="maxTransaction"
                  value="0.5"
                  step="0.1"
                  min="0.1"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Take Profit (%)</label>
                <input
                  type="number"
                  class="form-control"
                  id="takeProfit"
                  value="10"
                  min="1"
                  max="500"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Stop Loss (%)</label>
                <input
                  type="number"
                  class="form-control"
                  id="stopLoss"
                  value="5"
                  min="1"
                  max="50"
                />
              </div>
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="autoTrade" checked />
                <label class="form-check-label" for="autoTrade">Automatic Trading</label>
              </div>
            </div>
            <div class="trading-bot-card">
              <h5>Advanced Settings</h5>
              <div class="form-group">
                <label class="form-label">Slippage Tolerance (%)</label>
                <input
                  type="number"
                  class="form-control"
                  id="slippage"
                  value="1"
                  min="0.1"
                  max="50"
                  step="0.1"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Gas Priority</label>
                <select class="form-select" id="gasPriority">
                  <option value="low">Low</option>
                  <option value="medium" selected>Medium</option>
                  <option value="high">High</option>
                </select>
              </div>
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="frontrunProtection"
                  checked
                />
                <label class="form-check-label" for="frontrunProtection"
                  >Frontrunning Protection</label
                >
              </div>
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="autoAdjust" />
                <label class="form-check-label" for="autoAdjust"
                  >Auto-adjust based on market conditions</label
                >
              </div>
            </div>
          </div>
          <!-- Manual Trading Tab -->
          <div id="manual-trade" class="tab-content">
            <h4>Manual Trading</h4>
            <div class="trading-bot-card">
              <h5>Buy Tokens</h5>
              <div class="form-group">
                <label class="form-label">Token Address</label>
                <input
  function toggleBot(enabled) {
    const activeWalletId = document.querySelector(".wallet-item.active").getAttribute("data-wallet-id");
    const endpoint = enabled 
      ? `/api/trading/${activeWalletId}/enable` 
      : `/api/trading/${activeWalletId}/disable`;
      
    fetch(endpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        const statusIndicator = document.querySelector(".trading-bot-status .status-indicator");
        const statusText = statusIndicator.nextElementSibling;
        if (enabled) {
          statusIndicator.classList.remove("status-inactive");
          statusIndicator.classList.add("status-active");
          statusText.textContent = "Active";
        } else {
  function executeBuy() {
    const activeWalletId = document.querySelector(".wallet-item.active").getAttribute("data-wallet-id");
    const tokenAddress = document.getElementById("buyTokenAddress").value;
    const amount = document.getElementById("buyAmount").value;
    
    if (!tokenAddress) {
    // Select wallet
    function selectWallet(element) {
      document.querySelectorAll(".wallet-item").forEach(item => {
        item.classList.remove("active");
      });
      element.classList.add("active");
      
      // Update wallet details section
      const walletId = element.getAttribute("data-wallet-id");
      fetch(`/api/wallets/${walletId}/set-active`, {
        method: "POST",
        headers: { "Content-Type": "application/json" }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload(); // Reload to update all wallet-related info
        } else {
          showNotification(`Error: ${data.error || "Unknown error"}`, "error");
        }
      })
      .catch(error => {
        showNotification(`Network error: ${error.message}`, "error");
      });
    }
      showNotification("Please enter a token address", "error");
      return;
    }
    if (!amount || isNaN(amount) || amount <= 0) {
      showNotification("Please enter a valid amount", "error");
      return;
    }
    
    fetch(`/api/trading/${activeWalletId}/buy`, {
  function executeSell() {
    const activeWalletId = document.querySelector(".wallet-item.active").getAttribute("data-wallet-id");
    const token = document.getElementById("sellTokenSelect").value;
    const amount = document.getElementById("sellAmount").value;
    
    if (!token) {
      showNotification("Please select a token", "error");
      return;
    }
    if (!amount || isNaN(amount) || amount <= 0 || amount > 100) {
      showNotification("Please enter a valid amount percentage", "error");
      return;
    }
    
    fetch(`/api/trading/${activeWalletId}/sell`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount_tokens: parseFloat(amount), token_address: token })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        showNotification(data.message, "success");
      } else {
        showNotification(`Error: ${data.message || "Unknown error"}`, "error");
      }
    })
    .catch(error => {
      showNotification(`Network error: ${error.message}`, "error");
    });
  }
    })
    .catch(error => {
      showNotification(`Network error: ${error.message}`, "error");
    });
  }
    });
  }
                  min="0.01"
                  step="0.01"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Slippage (%)</label>
                <input
                  type="number"
                  class="form-control"
                  id="buySlippage"
                  value="1"
                  min="0.1"
                  max="50"
                  step="0.1"
                />
              </div>
              <button class="btn btn-secondary" onclick="executeBuy()">Buy Tokens</button>
            </div>
            <div class="trading-bot-card">
              <h5>Sell Tokens</h5>
              <div class="form-group">
                <label class="form-label">Token</label>
                <select class="form-select" id="sellTokenSelect">
                  <option value="">Select a token</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Amount (% of holdings)</label>
                <input
                  type="number"
                  class="form-control"
                  id="sellAmount"
                  value="100"
                  min="1"
                  max="100"
                />
              </div>
              <div class="form-group">
                <label class="form-label">Slippage (%)</label>
                <input
                  type="number"
                  class="form-control"
                  id="sellSlippage"
                  value="1"
                  min="0.1"
                  max="50"
                  step="0.1"
                />
              </div>
              <button class="btn btn-outline" onclick="executeSell()">Sell Tokens</button>
            </div>
          </div>
          <!-- Trade History Tab -->
          <div id="trade-history" class="tab-content">
            <h4>Trade History</h4>
            <div class="trading-bot-card">
              <div style="opacity: 0.7; text-align: center; padding: 30px;">
                No trading history available
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Tokens Card -->
      <div class="card">
        <div class="card-header">
          <h3>Tokens</h3>
          <button class="btn btn-sm btn-outline">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
        <div class="card-body">
          <div style="text-align: center; padding: 30px;">
            <div
              class="spinner"
              style="
                display: inline-block;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                border: 2px solid #ccc;
                border-top-color: var(--primary-color);
                animation: spin 1s linear infinite;
              "
            ></div>
            <div style="margin-top: 10px;">Loading tokens...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Tab switching functionality
    document.querySelectorAll('.tab-link').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    // Toggle bot status
    function toggleBot(enabled) {
      const statusIndicator = document.querySelector('.trading-bot-status .status-indicator');
      const statusText = statusIndicator.nextElementSibling;
      if (enabled) {
        statusIndicator.classList.remove('status-inactive');
        statusIndicator.classList.add('status-active');
        statusText.textContent = 'Active';
        showNotification('Bot activated successfully!', 'success');
      } else {
        statusIndicator.classList.remove('status-active');
        statusIndicator.classList.add('status-inactive');
        statusText.textContent = 'Inactive';
        showNotification('Bot deactivated', 'info');
      }
    }

    // Save strategy settings
    function saveStrategy() {
      showNotification('Strategy settings saved successfully!', 'success');
    }

    // Execute buy
    function executeBuy() {
      const tokenAddress = document.getElementById('buyTokenAddress').value;
      const amount = document.getElementById('buyAmount').value;
      if (!tokenAddress) {
        showNotification('Please enter a token address', 'error');
        return;
      }
      if (!amount || isNaN(amount) || amount <= 0) {
        showNotification('Please enter a valid amount', 'error');
        return;
      }
      // Simulate a buy request
      setTimeout(() => {
        showNotification(`Successfully placed buy order for ${amount} SOL`, 'success');
      }, 1000);
    }

    // Execute sell
    function executeSell() {
      const token = document.getElementById('sellTokenSelect').value;
      const amount = document.getElementById('sellAmount').value;
      if (!token) {
        showNotification('Please select a token', 'error');
        return;
      }
      if (!amount || isNaN(amount) || amount <= 0 || amount > 100) {
        showNotification('Please enter a valid amount', 'error');
        return;
      }
      // Simulate a sell request
      setTimeout(() => {
        showNotification(`Successfully placed sell order for ${amount}% of tokens`, 'success');
      }, 1000);
    }

    // Copy to clipboard
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showNotification('Address copied to clipboard!', 'success');
      }).catch(err => {
        showNotification('Failed to copy: ' + err, 'error');
      });
    }

    // Notification system
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.right = '20px';
      notification.style.padding = '10px 20px';
      notification.style.borderRadius = '4px';
      notification.style.zIndex = '1000';
      notification.style.minWidth = '250px';
      notification.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      notification.style.transition = 'all 0.3s ease';
      notification.style.opacity = '0';
      notification.style.transform = 'translateY(20px)';
      if (type === 'success') {
        notification.style.backgroundColor = 'rgba(20, 241, 149, 0.2)';
        notification.style.color = '#14F195';
        notification.style.border = '1px solid #14F195';
        message = '✓ ' + message;
      } else if (type === 'error') {
        notification.style.backgroundColor = 'rgba(255, 85, 85, 0.2)';
        notification.style.color = '#FF5555';
        notification.style.border = '1px solid #FF5555';
        message = '✕ ' + message;
      } else {
        notification.style.backgroundColor = 'rgba(153, 69, 255, 0.2)';
        notification.style.color = '#9945FF';
        notification.style.border = '1px solid #9945FF';
        message = 'ℹ ' + message;
      }
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(20px)';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // Add keyframes for spinner animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>

